# 配置指南

## 工作模式

### 黑名单模式
拦截指定的IP地址，其他IP正常访问。

**适用场景：**
- 已知恶意IP
- 特定攻击来源
- 临时封禁某些IP

**配置示例：**
```
工作模式：黑名单模式
IP黑名单：
203.0.113.10
198.51.100.0/24
```

### 白名单模式
仅允许指定IP访问，其他IP全部拦截。

**适用场景：**
- 内部系统
- 测试环境
- 高安全要求场景

**配置示例：**
```
工作模式：白名单模式
IP白名单：
192.168.1.0/24
10.0.0.0/8
```

### 智能模式（推荐）
自动识别威胁并拦截，无需手动维护黑名单。

**检测项目：**
- 访问频率异常
- 敏感词扫描
- 攻击特征识别
- 地理位置限制

**配置示例：**
```
工作模式：智能模式
访问间隔：10秒
敏感词列表：admin, wp-admin, phpmyadmin
```

## IP规则配置

### 单个IP
```
192.168.1.100
203.0.113.50
```

### IP范围
```
192.168.1.1-50
10.0.0.1-100
```

### 通配符
```
192.168.1.*
10.0.*.*
```

### CIDR格式
```
192.168.1.0/24
10.0.0.0/8
2001:db8::/32
```

### 注释
```
192.168.1.100    # 办公室IP
10.0.0.0/8       # 内网段
```

## 黑名单处理模式

### 完全禁止访问
直接拦截并显示403页面。

**配置：**
```
黑名单处理模式：完全禁止访问
```

### 限制访问频率
允许访问但限制频率，超过限制则拦截。

**配置：**
```
黑名单处理模式：限制访问频率
访问间隔：10秒
```

## 白名单配置

### IP白名单
允许访问的IP地址，不受任何限制。

**配置示例：**
```
192.168.1.0/24    # 办公室网段
10.0.0.1          # VPN出口
```

### User-Agent白名单
允许的UA，常用于搜索引擎爬虫。

**配置示例：**
```
Googlebot
Baiduspider
bingbot
```

### URL白名单
允许访问的URL路径（正则表达式）。

**配置示例：**
```
^/feed
^/sitemap\.xml$
^/robots\.txt$
```

## 安全防护

### SQL注入防护
检测并拦截SQL注入攻击。

**配置：**
```
☑ 启用SQL注入防护
```

### XSS攻击防护
检测并拦截跨站脚本攻击。

**配置：**
```
☑ 启用XSS攻击防护
```

### CSRF攻击防护
检测并拦截跨站请求伪造攻击。

**配置：**
```
☑ 启用CSRF攻击防护
```

## 地理位置限制

### 配置格式
每行一个地区名称，支持国家、省份、城市。

**配置示例：**
```
美国
俄罗斯
广东省|深圳市
```

### 匹配规则
- 精确匹配：完全匹配地区名称
- 包含匹配：地区信息包含关键词
- 多条件：使用 | 分隔多个条件

## 敏感词过滤

### 配置格式
每行一个敏感词，支持正则表达式。

**配置示例：**
```
admin
wp-admin
phpmyadmin
\.env$
\.git
```

### 匹配位置
- URL路径
- 查询参数
- POST数据

## 访问频率控制

### 访问间隔
两次访问之间的最小间隔时间（秒）。

**配置示例：**
```
访问间隔：10
```

**说明：**
- 0表示不限制
- 建议值：5-15秒
- 黑名单IP使用更严格的间隔（10%）

## 自定义拦截提示

### 配置格式
支持HTML格式的自定义消息。

**配置示例：**
```
抱歉，您的访问被系统安全策略拦截。
如有疑问，请联系管理员。
```

## 登录验证码

### 启用验证码
为后台登录添加验证码保护。

**配置：**
```
☑ 启用登录验证码保护
```

**效果：**
- 登录页面显示验证码
- 必须输入正确验证码才能登录
- 防止暴力破解

## 访客日志

### 启用日志记录
记录所有访客访问信息。

**配置：**
```
☑ 启用访客日志记录
日志保留天数：30
```

**记录内容：**
- 访问IP
- 访问时间
- 访问URL
- User-Agent
- 地理位置

### 机器人识别
配置机器人关键词，这些访问不会被记录。

**配置示例：**
```
baidu=>百度
google=>谷歌
bing=>必应
```

## 调试模式

### 启用调试
开启后会在错误日志中记录详细信息。

**配置：**
```
调试模式：开启
```

**日志位置：**
- PHP错误日志
- 服务器错误日志

**警告：** 生产环境请关闭调试模式！

## 配置优先级

配置项的优先级从高到低：

1. IP白名单
2. URL白名单
3. UA白名单
4. 后台访问白名单
5. 安全检测
6. 地理位置限制
7. IP黑名单
8. 智能检测

## 配置建议

### 基础配置
```
工作模式：智能模式
访问间隔：10秒
☑ 启用SQL注入防护
☑ 启用XSS攻击防护
☑ 启用访客日志记录
```

### 高安全配置
```
工作模式：白名单模式
IP白名单：[您的IP]
☑ 启用所有安全防护
☑ 启用登录验证码
后台访问IP白名单：[您的IP]
```

### 性能优化配置
```
工作模式：黑名单模式
访问间隔：0
□ 禁用访客日志记录
调试模式：关闭
```

## 下一步

配置完成后，请查看：
- [后台白名单使用指南](./admin-whitelist.md)
- [安全最佳实践](./security-best-practices.md)
- [故障排查](./troubleshooting.md)
